<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ResearchMate</title>
    <link rel="stylesheet" href="../popup/popup.css" />
  </head>
  <body class="booting">
    <!-- Animated background (behind everything) -->
    <div class="gradient-bg" aria-hidden="true">
      <svg xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="goo">
            <feGaussianBlur
              in="SourceGraphic"
              stdDeviation="10"
              result="blur"
            />
            <feColorMatrix
              in="blur"
              mode="matrix"
              values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -8"
              result="goo"
            />
            <feBlend in="SourceGraphic" in2="goo" />
          </filter>
        </defs>
      </svg>
      <div class="gradients-container">
        <div class="g1"></div>
        <div class="g2"></div>
        <div class="g3"></div>
        <div class="g4"></div>
        <div class="g5"></div>
        <div class="interactive"></div>
      </div>
    </div>

    <!-- AUTH (shown first) -->
    <div id="boot-splash">
      <div class="boot-card">
        <span class="dot"></span>
        <div>ResearchMate</div>
      </div>
    </div>

    <div id="auth">
      <div class="card auth-card">
        <h2>Welcome to ResearchMate</h2>
        <p class="sub">Sign in to sync your highlights across devices.</p>

        <div class="form">
          <input
            id="email"
            type="email"
            placeholder="Email"
            autocomplete="username"
          />
          <input
            id="password"
            type="password"
            placeholder="Password (min 6 chars)"
            autocomplete="new-password"
          />
        </div>

        <div class="auth-actions">
          <button id="signup" class="secondary-btn" type="button">
            Sign up
          </button>
          <button id="signin" class="primary-btn" type="button">Sign in</button>
          <!-- (optional) Google button stays here too -->
        </div>

        <pre id="auth-log" class="log hidden" aria-live="polite"></pre>
      </div>
    </div>

    <!-- APP (after login) -->
    <div id="app" class="container hidden">
      <header>
        <h1>
          <!-- book-open icon -->
          <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
            <path
              d="M21 4H12a4 4 0 0 0-4 4v10a3 3 0 0 1 3-3h10V4zM3 6a2 2 0 0 1 2-2h7v13H8a3 3 0 0 0-3 3V6z"
              fill="currentColor"
            />
          </svg>
          ResearchMate
        </h1>

        <div class="tabs">
          <button class="tab-btn active" data-tab="collect" title="Highlight">
            <!-- highlighter icon -->
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M3 16l5 5 3-3-5-5-3 3zm6-6l5 5 6-6-5-5-6 6z"
                fill="currentColor"
              />
            </svg>
          </button>
          <button class="tab-btn" data-tab="saved" title="Saved">
            <!-- bookmark icon -->
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path d="M6 2h12v20l-6-4-6 4V2z" fill="currentColor" />
            </svg>
          </button>
          <!-- ✅ ADD CITATION TAB BUTTON -->
          <button
            class="tab-btn"
            data-tab="citation"
            title="Citation"
            style="display: none"
            id="citation-tab-btn"
          >
            <!-- quote icon -->
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"
                fill="currentColor"
              />
            </svg>
          </button>
          <button
            class="tab-btn"
            data-tab="edit"
            title="Edit"
            style="display: none"
            id="edit-tab-btn"
          >
            <!-- edit icon -->
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
                fill="currentColor"
              />
            </svg>
          </button>
          <button class="tab-btn" data-tab="summary" title="AI">
            <!-- robot icon -->
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M9 2h6v2h3a2 2 0 012 2v8a4 4 0 01-4 4h-8a4 4 0 01-4-4V6a2 2 0 012-2h3V2h2zM7 10h2v2H7v-2zm8 0h2v2h-2v-2z"
                fill="currentColor"
              />
            </svg>
          </button>
          <button class="tab-btn" data-tab="settings" title="Settings">
            <!-- gear icon -->
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path
                d="M12 8a4 4 0 100 8 4 4 0 000-8zm9 4a7.9 7.9 0 00-.2-1.8l2.1-1.6-2-3.5-2.6 1a8 8 0 00-3.1-1.8L14.8 2h-5.6l-.4 3.3A8 8 0 005.7 7l-2.6-1-2 3.5 2.1 1.6A8 8 0 003 12c0 .6.1 1.2.2 1.8L1.1 15.4l2 3.5 2.6-1a8 8 0 003.1 1.8l.4 3.3h5.6l.4-3.3a8 8 0 003.1-1.8l2.6 1 2-3.5-2.1-1.6c.1-.6.2-1.2.2-1.8z"
                fill="currentColor"
              />
            </svg>
          </button>
        </div>
      </header>

      <!-- Collect -->
      <div class="tab-content active" id="collect-tab">
        <h3>Current Selection</h3>
        <div id="selected-text" class="selection-preview"></div>
        <div class="form-group">
          <label class="lbl">Tags (comma separated):</label>
          <div class="tag-input-container">
            <div class="tag-chips" id="tag-chips"></div>
            <input type="text" id="tags-input" placeholder="Add tags..." />
          </div>
        </div>

        <div class="form-group">
          <label class="lbl">Notes:</label>
          <textarea
            id="notes-input"
            rows="2"
            placeholder="Optional notes..."
          ></textarea>
        </div>

        <div class="row">
          <button id="save-btn" class="primary-btn" type="button">
            <svg viewBox="0 0 24 24" width="16" height="16">
              <path d="M5 20h14v-9H5v9zm14-11V4H5v5h14z" fill="currentColor" />
            </svg>
            Save Selection
          </button>

          <!-- small meta on the right (domain/title); keep this, it’s not a label -->
          <span
            id="captured-meta"
            class="muted small"
            style="margin-left: auto"
          ></span>
        </div>
      </div>

      <!-- Saved -->
      <div class="tab-content" id="saved-tab">
        <div class="search-box">
          <input
            id="search-input"
            type="text"
            placeholder="Search saved items..."
          />
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path
              d="M15.5 14h-.8l-.3-.3A6.5 6.5 0 1015.5 14l4.5 4.5-1.5 1.5L15.5 14zM10 15a5 5 0 110-10 5 5 0 010 10z"
              fill="currentColor"
            />
          </svg>
        </div>
        <div id="saved-items-list" class="saved-items">
          <div class="empty-state" id="empty-state">
            <div class="empty-icon">
              <svg viewBox="0 0 24 24" width="48" height="48">
                <path
                  d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                  opacity="0.3"
                />
              </svg>
            </div>
            <h3>Start Your Research Journey</h3>
            <p>
              Highlight text on any webpage to save your first research note
            </p>
            <div class="empty-actions">
              <button
                class="secondary-btn"
                onclick="chrome.tabs.create({url: 'https://example.com'})"
              >
                Try on a Sample Page
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit -->
      <div class="tab-content" id="edit-tab">
        <div class="card editor-card">
          <h3>Edit tags & notes</h3>
          <div class="muted small" id="edit-meta"></div>

          <div class="form-group">
            <label class="lbl">Tags (comma separated):</label>
            <input id="edit-tags" type="text" placeholder="tag1, tag2, …" />
          </div>

          <div class="form-group">
            <label class="lbl">Notes:</label>
            <textarea
              id="edit-notes"
              rows="4"
              placeholder="Add your note…"
            ></textarea>
          </div>

          <div class="row right" style="gap: 8px">
            <button id="edit-cancel" class="secondary-btn" type="button">
              Cancel
            </button>
            <button id="edit-save" class="primary-btn" type="button">
              Save changes
            </button>
          </div>
        </div>
      </div>

      <!-- Citation -->
      <div class="tab-content" id="citation-tab">
        <div class="card">
          <h3>Citation Builder</h3>
          <p
            class="muted small"
            id="citation-meta"
            style="margin-bottom: 12px"
          ></p>

          <div class="row" style="gap: 8px; margin-bottom: 12px">
            <label class="lbl" style="flex: 1">
              Style
              <select id="cite-style">
                <option value="apa">APA 7</option>
                <option value="mla">MLA 9</option>
                <option value="chicago">Chicago (author-date)</option>
              </select>
            </label>

            <label class="lbl" style="flex: 1">
              Type
              <select id="cite-type">
                <option value="web">Web page</option>
                <option value="article">Journal article</option>
                <option value="book">Book</option>
              </select>
            </label>
          </div>

          <label class="lbl">
            Authors (one per line, "First Last")
            <textarea
              id="cite-authors"
              rows="2"
              placeholder="Ada Lovelace&#10;Alan Turing"
            ></textarea>
          </label>

          <label class="lbl">
            Title
            <input
              id="cite-title"
              type="text"
              placeholder="Article or page title"
            />
          </label>

          <label class="lbl">
            Website / Journal
            <input
              id="cite-container"
              type="text"
              placeholder="Website or journal name"
            />
          </label>

          <div class="row" style="gap: 8px">
            <label class="lbl" style="flex: 1">
              Year
              <input id="cite-year" type="text" placeholder="YYYY" />
            </label>
            <label class="lbl" style="flex: 1">
              Month
              <input id="cite-month" type="text" placeholder="MM" />
            </label>
            <label class="lbl" style="flex: 1">
              Day
              <input id="cite-day" type="text" placeholder="DD" />
            </label>
          </div>

          <label class="lbl">
            URL
            <input id="cite-url" type="text" placeholder="https://..." />
          </label>

          <!-- Citation Output -->
          <div
            id="cite-output"
            class="cite-output"
            style="margin-top: 12px"
          ></div>

          <div class="row" style="gap: 8px; margin-top: 12px">
            <button id="cite-copy" class="primary-btn" style="flex: 1">
              Copy Citation
            </button>
            <button id="cite-cancel" class="secondary-btn">Cancel</button>
          </div>
        </div>
      </div>

      <!-- AI -->
      <div class="tab-content" id="summary-tab">
        <!-- API key row ONLY lives in this tab -->
        <div class="row" style="gap: 8px; margin-bottom: 8px">
          <input id="aiKey" type="password" style="flex: 1" />
          <button id="saveAIKey" class="secondary-btn" type="button">
            Save Key
          </button>
        </div>

        <textarea
          id="summary-input"
          placeholder="Paste text to summarize..."
        ></textarea>

        <div class="row center" style="margin-top: 8px">
          <button id="summarize-btn" class="primary-btn" type="button">
            Generate Summary
          </button>
        </div>

        <div id="summary-result" class="hidden">
          <h3>AI Summary</h3>
          <div class="summary-content"></div>
        </div>
      </div>

      <!-- Settings -->
      <div class="tab-content" id="settings-tab">
        <div class="row">
          <button id="exportData" class="secondary-btn">📤 Export Data</button>
          <button id="importData" class="secondary-btn">📥 Import Data</button>
          <button id="shuffleTheme" class="secondary-btn" type="button">
            Shuffle Theme
          </button>
        </div>
        <div class="row center" style="margin-bottom: 8px"></div>
        <div class="row">
          <label><input type="checkbox" id="darkMode" /> Dark mode</label>
        </div>
        <div class="row">
          <label
            >Font
            <select id="fontFamily">
              <option value="system-ui">System</option>
              <option value="serif">Serif</option>
              <option value="monospace">Monospace</option>
            </select>
          </label>
          <label style="margin-left: auto"
            >Size
            <input id="fontSize" type="range" min="12" max="18" value="14" />
          </label>
        </div>
        <div class="row right">
          <button id="signout" class="danger-btn" type="button">Logout</button>
        </div>
      </div>
    </div>
    <div id="toast" class="toast" role="status" aria-live="polite"></div>
    <script type="module" src="popup.js"></script>
  </body>
</html>
